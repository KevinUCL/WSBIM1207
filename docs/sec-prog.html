<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Chapter 9 Additional programming concepts | Introduction to bioinformatics" />
<meta property="og:type" content="book" />


<meta property="og:description" content="Course material for the Introduction to bioinformatics (WSBIM1207) course at UCLouvain." />


<meta name="author" content="Laurent Gatto" />

<meta name="date" content="2019-03-12" />


<meta name="description" content="Course material for the Introduction to bioinformatics (WSBIM1207) course at UCLouvain.">

<title>Chapter 9 Additional programming concepts | Introduction to bioinformatics</title>

<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/envisioned.css" rel="stylesheet" />
<link href="libs/msmb-css-0/msmb.css" rel="stylesheet" />
<script>
function toggle_visibility(id1, id2) {
var e = document.getElementById(id1);
var f = document.getElementById(id2);

e.style.display = ((e.style.display!='none') ? 'none' : 'block');

if(f.classList.contains('fa-plus-square')) {
    f.classList.add('fa-minus-square')
    f.classList.remove('fa-plus-square')
} else {
    f.classList.add('fa-plus-square')
    f.classList.remove('fa-minus-square')
}

}
</script>
<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/jquery-1.12.4/jquery.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.5/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul class="navbar">
<li class="msmb"><p class="title">Introduction to bioinformatics<p><p class="author">Laurent Gatto</p>
<li class="dropdown" style="float:right">
<a href="javascript:void(0)" class="dropbtn">&#x25BE; Chapters</a>
<div class="dropdown-content">
<a href="index.html">Preamble</a>
<a href="sec-dataorg.html"><span class="toc-section-number">1</span> Data organisation with Spreadsheets</a>
<a href="sec-startr.html"><span class="toc-section-number">2</span> Starting with R</a>
<a href="sec-startdata.html"><span class="toc-section-number">3</span> Starting with data</a>
<a href="sec-dplyr.html"><span class="toc-section-number">4</span> Manipulating and analyzing data with dplyr</a>
<a href="sec-vis.html"><span class="toc-section-number">5</span> Data visualization</a>
<a href="sec-join.html"><span class="toc-section-number">6</span> Joining tables</a>
<a href="sec-rr.html"><span class="toc-section-number">7</span> Reproducible research</a>
<a href="sec-bioinfo.html"><span class="toc-section-number">8</span> Bioinformatics</a>
<a id="active-page" href="sec-prog.html"><span class="toc-section-number">9</span> Additional programming concepts</a><ul class="toc-sections">
<li class="toc"><a href="#writing-clean-code"> Writing clean code</a></li>
<li class="toc"><a href="#iteration"> Iteration</a></li>
<li class="toc"><a href="#conditionals"> Conditionals</a></li>
<li class="toc"><a href="#writing-new-functions"> Writing new functions</a></li>
<li class="toc"><a href="#pattern-matching"> Pattern matching</a></li>
<li class="toc"><a href="#analysing-data-from-multiple-files"> Analysing data from multiple files</a></li>
</ul>
<a href="sec-ccl.html"><span class="toc-section-number">10</span> Conclusions</a>
<a href="session-information.html">Session information</a>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="sec:prog" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> Additional programming concepts</h1>
<p><strong>Learning Objectives</strong></p>
<p>Learn programming concepts, including</p>
<ul>
<li>how to handle conditions</li>
<li>iterate of data structures</li>
<li>good coding practice</li>
<li>code re-use through functions</li>
</ul>
<p>When the size and the complexity of the data increases, or the data science question of interest becomes more complex, the data analysis techniques as we have seen them so far need to be complemented with programming techniques. From a data science point of view, there is no clear delimitation between data analysis and (data) programming, both morphing into each other<label for="tufte-sn-17" class="margin-toggle sidenote-number">17</label><input type="checkbox" id="tufte-sn-17" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">17</span> A fundamental difference however is how data analysis and programming are taught. When it comes to researchers, and biomedical researchers in particular, teaching programming to analyse data isn’t successful. Teaching data analysis to eventually programme with data, however, has proven a successful strategy.</span>.</p>
<p>This chapter will introduce some additional programming skills and demonstrate how to use them in the context of high troughput omics data.</p>
<div id="writing-clean-code" class="section level2">
<h2><span class="header-section-number">9.1</span> Writing clean code</h2>
<p>Writing clean code means writing easily readable code, hence easily understable code and, eventually code with less bugs. One easy way to achieve this is through consistency, i.e. stick to a <strong>style guide</strong>. This issue is that there are several style guides available, often with conflicting suggestions. Two widely used ones are the <a href="http://bioconductor.org/developers/how-to/coding-style/">Bioconductor style guide</a> and <a href="http://r-pkgs.had.co.nz/style.html">Hadley Wickhams’s R Style Guide</a>. The advice from for naming variables seen in the first and second chapters are also relevant.</p>
<p>Here are a couple of suggestions:</p>
<ul>
<li>Use <code>&lt;-</code> to assign variables. Use <code>=</code> is also valid, but make sure that you stick with one.</li>
<li>Use either camel case (<code>camelCaseNaming</code>) of snake case (<code>snake_case_naming</code>), and avoid using dots (don’t use <code>dot.variable.names</code>). These conventions apply to functions, variables and files (for the latter, a <code>-</code> instead of <code>_</code> is also acceptable).</li>
<li>Always spell out <code>TRUE</code> and <code>FALSE</code>, and resist the temptation to use <code>T</code> and <code>F</code> instead<label for="tufte-sn-18" class="margin-toggle sidenote-number">18</label><input type="checkbox" id="tufte-sn-18" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">18</span> <code>TRUE</code> and <code>FALSE</code> are reserved words; one can’t use them as variable names. This however doesn’t hold for <code>T</code> and <code>F</code>. One can use <code>T</code> and <code>F</code> as regular variable names such, as for example, <code>T &lt;- FALSE</code> and <code>F &lt;- TRUE</code>!</span>.</li>
<li>Use 4 spaces for indenting. No tabs.</li>
<li>No lines longer than 80 characters.</li>
<li>Use spaces around binary operators.</li>
<li>No spaces between a function name and the opening parenthesis.</li>
</ul>
<p>Another good advise is to avoid re-writing the same code many times. We will see below two strategies to do that, namely iteration and writing new functions. This firstly reduces the amount of code typed and hence the number of bugs, but more importantly enables consistency. If something in your code changes, there’s only one change and it applies everywhere, rather than doing that same change repeatedly (at the first of adding bugs and to miss some updates).</p>
<p>When writing code, <strong>keep it simple and short</strong><label for="tufte-sn-19" class="margin-toggle sidenote-number">19</label><input type="checkbox" id="tufte-sn-19" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">19</span> The official motto is <a href="https://en.wikipedia.org/wiki/KISS_principle">KISS</a>, <em>keep your functions simple, stupid</em>, widely used in programming.</span>. Ideally, the code should be evident. But when the questions tackled are not trivial, is becomes essential to add <strong>comments</strong> to clarify aspects of the script/programme. Make sure to use them to describe why something is done, rather than explaining how things are done (which is tyically best done by the code itself).</p>
<p>A general guideline to avoid bugs is to apply <strong>defensive programming</strong>:</p>
<ul>
<li>making the code work in a predicable manner</li>
<li>writing code that fails in a well-defined manner</li>
<li>if something weird happens, either properly deal with it, of fail quickly and loudly</li>
</ul>
<p>Here are some examples of how to do this:</p>
<ul>
<li><p>use functions like <code>is.numeric(x)</code>, <code>is.character(x)</code>, <code>is.data.frame(x)</code>, … for make sure that the variable you are going to use is of the expected type.</p></li>
<li><p>Make sure the length or dimensions of what you are going to use are what you expect:</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>
<span class="kw">nrow</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>
<span class="kw">ncol</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></code></pre></div>
<ul>
<li>Failing fast and well! Wrap such test in <code>stopifnot()</code>, so that if they fail, you get immediately an error, rather than risking that you code fails later with obscure error messages or, worse, the code runs to completion but returns meaningless results.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">stopifnot</span>(<span class="kw">length</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)
<span class="kw">stopifnot</span>(<span class="kw">ncol</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="kw">nrow</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</code></pre></div>
</div>
<div id="iteration" class="section level2">
<h2><span class="header-section-number">9.2</span> Iteration</h2>
<p>Iteration describes the situtation when a specific operation has to be repeated many times on different inputs of the same type. For example, if we have a vector of numeric <code>x</code> shown below,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<p>and we wanted to apply the logarithm operation on each element of <code>x</code>, it wouldn’t be convenient to type</p>
<pre><code>log(1)
log(2)
log(3)
...
log(10)</code></pre>
<p>The concept of iteration allows us to programme the following command:</p>
<blockquote>
<p>Repeat <code>log</code> for each value of my input <code>x</code>.</p>
</blockquote>
<p>or more formally</p>
<blockquote>
<p>Repeat <code>log(i)</code> where <code>i</code> takes in turn each value of my input <code>x</code>.</p>
</blockquote>
<p>We will see different ways of implementing such an iteration.</p>
<div id="using-a-for-loop" class="section level3 unnumbered">
<h3>Using a <code>for</code> loop</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span> (i <span class="cf">in</span> x) {
    <span class="kw">print</span>(<span class="kw">log</span>(i))
}</code></pre></div>
<pre><code>## [1] 0
## [1] 0.6931472
## [1] 1.098612
## [1] 1.386294
## [1] 1.609438
## [1] 1.791759
## [1] 1.94591
## [1] 2.079442
## [1] 2.197225
## [1] 2.302585</code></pre>
<p>The loop above only prints the results on screen. They aren’t stored and are lost for any further re-use, which would be very annoying if if took much more time to perform all the calculations. In the code chunk below, we are going to first inititalise a vector with the appropriate number of <code>NA</code> values and, at each iteration, we then store the result. We however now need to change our loop and iterate of the indices of the input vector, so that we can re-use these indices to save the results in the output vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res_loop &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(x))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {
    res_loop[i] &lt;-<span class="st"> </span><span class="kw">log</span>(x[i])
}
res_loop</code></pre></div>
<pre><code>##  [1] 0.0000000 0.6931472 1.0986123 1.3862944 1.6094379 1.7917595 1.9459101
##  [8] 2.0794415 2.1972246 2.3025851</code></pre>
</div>
<div id="using-the-apply-function" class="section level3 unnumbered">
<h3>Using the <code>apply</code> function</h3>
<p>The apply family of functions implements our defintion of iteration quite literally</p>
<blockquote>
<p>Repeat <code>log</code> for each value of my input <code>x</code></p>
</blockquote>
<p>is reformulated as</p>
<blockquote>
<p>For each value of my input <code>x</code>, apply <code>log</code></p>
</blockquote>
<p>and coded as</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res_apply &lt;-<span class="st"> </span><span class="kw">sapply</span>(x, log)
res_apply</code></pre></div>
<pre><code>##  [1] 0.0000000 0.6931472 1.0986123 1.3862944 1.6094379 1.7917595 1.9459101
##  [8] 2.0794415 2.1972246 2.3025851</code></pre>
<p>There are three such function that <em>apply</em> a function iteratively:</p>
<ul>
<li><p><code>sapply</code> iterates over a vector and returns a new vector of the same length as the input vector<label for="tufte-sn-20" class="margin-toggle sidenote-number">20</label><input type="checkbox" id="tufte-sn-20" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">20</span> This is a simplification of how <code>sapply</code> works, that is partly defined by the the <code>simplify</code> argument and whether the result of applying the function on each element of the input can be returned as a vector. The alternative is to return a <code>list</code>, like <code>lapply</code>.</span>.</p></li>
<li><p><code>lapply</code> iterates over a linear input (a vector of a list) and returns a list of the same length as the input.</p></li>
<li><p><code>apply</code> iterates of the rows or the columns of a <code>data.frame</code> or <code>matrix</code> and returns a list or vector or approritate length (number of rows or columns). The dimension over which the iterations proceeds is defined by the second argument, where <code>1</code> defines rows and <code>2</code> defined columns<label for="tufte-sn-21" class="margin-toggle sidenote-number">21</label><input type="checkbox" id="tufte-sn-21" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">21</span> This generalises to arrays with more than 2 dimensions.</span>.</p></li>
</ul>
<p>When performing the same operations in different ways (using different implementations), it is essential to verify that the results are identical or, if not, at least compatible. The most direct way to do the former is to use the <code>identical</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(res_loop, res_apply)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The <code>purrr</code> package a set of <code>map</code> functions similar to the <code>apply</code> set described above.</p>
</div>
<div id="vectorisation" class="section level3 unnumbered">
<h3>Vectorisation</h3>
<p>We must not forget the obvious, which is vectorisation. Many R functions work by default iteratively on every element of a vectors, i.e. they work irrespectively whether the vector is of length 1<label for="tufte-sn-22" class="margin-toggle sidenote-number">22</label><input type="checkbox" id="tufte-sn-22" class="margin-toggle"><span class="sidenote"><span class="sidenote-number">22</span> A vector of length 1 would be called a scalar in other programming languages.</span> or longer.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res_vec &lt;-<span class="st"> </span><span class="kw">log</span>(x)
res_vec</code></pre></div>
<pre><code>##  [1] 0.0000000 0.6931472 1.0986123 1.3862944 1.6094379 1.7917595 1.9459101
##  [8] 2.0794415 2.1972246 2.3025851</code></pre>
<p>And, as before, we check that we obtain identical results:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(res_loop, res_vec)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="which-iteration-to-use" class="section level3 unnumbered">
<h3>Which iteration to use?</h3>
<p>Even though they produce the same result, the iteration strategies above aren’t equal, and some should be preferred in different situations.</p>
<ul>
<li><p>When a vectorised solution exists, this is the one that should be chosen. It is by far the fastest solution, but only applicable to existing <em>vectorised</em> functions. If you were to write your own function to iterate over, it is advisable to write a vectorised function.</p></li>
<li><p>The apply functions are extremely convenient and concise, and hence widely used. They have a couple of advantages, including that there is no need to explicitly initialise a result variable and that they can easily be parallelised.</p></li>
<li><p>For loops are the most generic solution for iteration, and they require to initialise the result variable that will be populated during the loop. As opposed to popular belief, they aren’t slower than using apply functions. They are however the best solution if, during the iteration, one has the access another element than the one currently processed (typically, if <code>i</code> is the counter, accessing <code>i + 1</code> or <code>i - 1</code>).</p></li>
</ul>
<div class="question">
<p class="question-begin">
► Question
</p>
<div class="question-body">
<p>Use the <code>expressions.csv()</code> function from the <code>rWSBIM1207</code> package to get the path to 5 csv files containing gene expression data for a single gene and hundreds of patience. Read all data in and combine them into a single dataframe.</p>
<p>Before starting, open at least two of these files them to familiarise yourself with their structure and identify how and with what function they need to be combined.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="solution">
<p class="solution-begin">
► Solution<span id="sol-start-49" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-49&#39;, &#39;sol-start-49&#39;)"></span>
</p>
<div id="sol-body-49" class="solution-body" style="display: none;">
<p>Let’s start by loading the required packages and check two file. We will also use the <em>tidyverse</em> to work with the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;rWSBIM1207&quot;</span>)
fls &lt;-<span class="st"> </span><span class="kw">expressions.csv</span>()
<span class="kw">read_csv</span>(fls[<span class="dv">1</span>])</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   sampleID = col_character(),
##   patient = col_character(),
##   type = col_character(),
##   A1BG = col_double()
## )</code></pre>
<pre><code>## # A tibble: 570 x 4
##    sampleID         patient      type   A1BG
##    &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;
##  1 TCGA-05-4244-01A TCGA-05-4244 tumor  26.0
##  2 TCGA-05-4249-01A TCGA-05-4249 tumor 120. 
##  3 TCGA-05-4250-01A TCGA-05-4250 tumor  50.9
##  4 TCGA-05-4382-01A TCGA-05-4382 tumor 146. 
##  5 TCGA-05-4384-01A TCGA-05-4384 tumor 127. 
##  6 TCGA-05-4389-01A TCGA-05-4389 tumor  67.1
##  7 TCGA-05-4390-01A TCGA-05-4390 tumor 165. 
##  8 TCGA-05-4395-01A TCGA-05-4395 tumor  22.0
##  9 TCGA-05-4396-01A TCGA-05-4396 tumor  17.4
## 10 TCGA-05-4397-01A TCGA-05-4397 tumor 127. 
## # … with 560 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_csv</span>(fls[<span class="dv">2</span>])</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   sampleID = col_character(),
##   patient = col_character(),
##   type = col_character(),
##   A1CF = col_double()
## )</code></pre>
<pre><code>## # A tibble: 570 x 4
##    sampleID         patient      type    A1CF
##    &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;  &lt;dbl&gt;
##  1 TCGA-05-4244-01A TCGA-05-4244 tumor  0    
##  2 TCGA-05-4249-01A TCGA-05-4249 tumor  0.322
##  3 TCGA-05-4250-01A TCGA-05-4250 tumor  0    
##  4 TCGA-05-4382-01A TCGA-05-4382 tumor  0    
##  5 TCGA-05-4384-01A TCGA-05-4384 tumor  0    
##  6 TCGA-05-4389-01A TCGA-05-4389 tumor 36.2  
##  7 TCGA-05-4390-01A TCGA-05-4390 tumor  0    
##  8 TCGA-05-4395-01A TCGA-05-4395 tumor  0    
##  9 TCGA-05-4396-01A TCGA-05-4396 tumor 15.9  
## 10 TCGA-05-4397-01A TCGA-05-4397 tumor  0    
## # … with 560 more rows</code></pre>
<p>We see that the data will have to be combined column-wise. We could do it manually, adding news columns one by on to the first data, but this would require to check that the observations are in the same order. Instead, we will use a <code>full_join</code>, as seen in chapter <a href="sec-join.html#sec:join">6</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## read the first one
res &lt;-<span class="st"> </span><span class="kw">read_csv</span>(fls[<span class="dv">1</span>])
## iterate over the other data
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(fls)) {
    data_i &lt;-<span class="st"> </span><span class="kw">read_csv</span>(fls[i], <span class="dt">progress =</span> <span class="ot">FALSE</span>)
    res &lt;-<span class="st"> </span><span class="kw">full_join</span>(res, data_i)
}
res</code></pre></div>
<pre><code>## # A tibble: 570 x 8
##    sampleID         patient      type   A1BG   A1CF A2BP1 A2LD1   A2ML1
##    &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1 TCGA-05-4244-01A TCGA-05-4244 tumor  26.0  0      1.75 136.    0.349
##  2 TCGA-05-4249-01A TCGA-05-4249 tumor 120.   0.322  1.61  89.1   1.61 
##  3 TCGA-05-4250-01A TCGA-05-4250 tumor  50.9  0      0    151.    0    
##  4 TCGA-05-4382-01A TCGA-05-4382 tumor 146.   0      0    112.    4.79 
##  5 TCGA-05-4384-01A TCGA-05-4384 tumor 127.   0      0     87.6   0    
##  6 TCGA-05-4389-01A TCGA-05-4389 tumor  67.1 36.2    0    112.   36.6  
##  7 TCGA-05-4390-01A TCGA-05-4390 tumor 165.   0     97.7   64.9   0.639
##  8 TCGA-05-4395-01A TCGA-05-4395 tumor  22.0  0      0    181.  391.   
##  9 TCGA-05-4396-01A TCGA-05-4396 tumor  17.4 15.9    0    134.    0.758
## 10 TCGA-05-4397-01A TCGA-05-4397 tumor 127.   0      0    229.   19.2  
## # … with 560 more rows</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<!-- Possibly also mention `while`. -->
</div>
</div>
<div id="conditionals" class="section level2">
<h2><span class="header-section-number">9.3</span> Conditionals</h2>
<p>When an operation has to be executed when a condition is met, one typically uses a <code>if</code> and <code>else</code> construct:</p>
<pre><code>if (CONDITION) {
   ## DO SOMETHING
} else {
  ## DO SOMETHING ELSE
}</code></pre>
<p>For examples</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>))</code></pre></div>
<pre><code>## [1] -0.6264538</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) {
   <span class="kw">print</span>(<span class="kw">log</span>(x))
} <span class="cf">else</span> {
   <span class="kw">print</span>(<span class="kw">log</span>(<span class="op">-</span>x))
}   </code></pre></div>
<pre><code>## [1] -0.4676802</code></pre>
<p>But note that in the example above, it would be much better to simplify the code and use the absolute value of <code>x</code> before taking the log, which will generalise the calculation for positive and negative values …</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">log</span>(<span class="kw">abs</span>(x))</code></pre></div>
<pre><code>## [1] -0.4676802</code></pre>
<p>… and works for vectors of any length thanks to vectorisation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>)
<span class="kw">log</span>(<span class="kw">abs</span>(x))</code></pre></div>
<pre><code>##  [1] -1.6947599 -0.1795710  0.4670498 -1.1101553 -0.1978799 -0.7186105
##  [7] -0.3033716 -0.5520273 -1.1861709  0.4132885</code></pre>
</div>
<div id="writing-new-functions" class="section level2">
<h2><span class="header-section-number">9.4</span> Writing new functions</h2>
<p>A function is composed of a name, inputs (inside the parenthesis), a body (between curly brackets) and an ouput (last statement or variably inside the <code>return</code> statement).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_fun &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {
    <span class="kw">message</span>(<span class="st">&quot;First input: &quot;</span>, x)
    <span class="kw">message</span>(<span class="st">&quot;Second input: &quot;</span>, y)
    z &lt;-<span class="st"> </span>x <span class="op">*</span><span class="st"> </span><span class="kw">abs</span>(y)
    <span class="kw">return</span>(z)
}
<span class="kw">my_fun</span>(<span class="dv">2</span>, <span class="dv">-5</span>)</code></pre></div>
<pre><code>## First input: 2</code></pre>
<pre><code>## Second input: -5</code></pre>
<pre><code>## [1] 10</code></pre>
<div class="question">
<p class="question-begin">
► Question
</p>
<div class="question-body">
<p>Complete the following function. It is supposed to take two inputs, <code>x</code> and <code>y</code> and, depending whether the <code>x &gt; y</code> or <code>x &lt;= y</code>, it generates the permutation <code>sample(x, y)</code> in the first case or draws a sample from <code>rnorm(1000, x, y)</code> in the second case. Finally, it returns the sum of all values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fun &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {
    res &lt;-<span class="st"> </span><span class="ot">NA</span>
    <span class="cf">if</span> (   ) {
        res &lt;-<span class="st"> </span><span class="kw">sample</span>(, )
    } <span class="cf">else</span> {
        res &lt;-<span class="st"> </span><span class="kw">rnorm</span>(, , )
    }
    <span class="kw">return</span>()
}</code></pre></div>
<p>To check your answer, run it with inputs 5, 15 and 15, 5, after setting the random number generator to 1 each time with <code>set.seed(1)</code> and you should get 4825.2778709 and 32.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<div class="solution">
<p class="solution-begin">
► Solution<span id="sol-start-50" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-50&#39;, &#39;sol-start-50&#39;)"></span>
</p>
<div id="sol-body-50" class="solution-body" style="display: none;">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fun</code></pre></div>
<pre><code>## function(x, y) {
##     res &lt;- NA
##     if (x &gt; y) {
##         res &lt;- sample(x, y)
##     } else { ## here x &lt;= y
##         res &lt;- rnorm(1000, x, y)
##     }
##     return(sum(res))
## }
## &lt;bytecode: 0x56001834db18&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(1L)
res1 &lt;-<span class="st"> </span><span class="kw">fun</span>(<span class="dv">5</span>, <span class="dv">15</span>)
<span class="kw">set.seed</span>(1L)
res2 &lt;-<span class="st"> </span><span class="kw">fun</span>(<span class="dv">15</span>, <span class="dv">5</span>)</code></pre></div>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
</div>
<div id="pattern-matching" class="section level2">
<h2><span class="header-section-number">9.5</span> Pattern matching</h2>
<p>One skill that comes handy more often than not is the ability to find patterns in text and replace these. We are going to see two functions out of many to perform such tasks. As an illustration, we are going to mine a vector or peptides identified by mass spectrometry. The data can be loaded from the <code>rWSBIM1207</code> data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;rWSBIM1207&quot;</span>)
<span class="kw">data</span>(peptides)
<span class="kw">length</span>(peptides)</code></pre></div>
<pre><code>## [1] 26796</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(peptides)</code></pre></div>
<pre><code>## [1] &quot;aAAGEAk&quot; &quot;VTEEAk&quot;  &quot;aSGDPGk&quot; &quot;sAAAEAk&quot; &quot;aANAEGk&quot; &quot;aAAEEAR&quot;</code></pre>
<ol style="list-style-type: decimal">
<li>Among the 26796 petides, which ones contain the pattern <code>&quot;TAAE&quot;</code>?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> &quot;AAGE&quot;</span>
## indices of matching peptides
<span class="kw">grep</span>(pattern, peptides)</code></pre></div>
<pre><code>## [1]     1  7026 17140 21912 23423 24947 25257 26658</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## matching peptides
<span class="kw">grep</span>(pattern, peptides, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;aAAGEAk&quot;              &quot;aFHGAAGEAGAAFGNHGANR&quot; &quot;eAIDAAGEGGR&quot;         
## [4] &quot;sAAGEFADDPcSSVkR&quot;     &quot;eAAGEGPVLYEDPPDQk&quot;    &quot;eIEAAGEk&quot;            
## [7] &quot;dVQELYAAGENR&quot;         &quot;sAAGEFADDPcSSVk&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## position of matching peptides
<span class="kw">head</span>(<span class="kw">grepl</span>(pattern, peptides))</code></pre></div>
<pre><code>## [1]  TRUE FALSE FALSE FALSE FALSE FALSE</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Replace a pattern by another string.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(peptides)</code></pre></div>
<pre><code>## [1] &quot;aAAGEAk&quot; &quot;VTEEAk&quot;  &quot;aSGDPGk&quot; &quot;sAAAEAk&quot; &quot;aANAEGk&quot; &quot;aAAEEAR&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">sub</span>(<span class="st">&quot;AE&quot;</span>, <span class="st">&quot;XX&quot;</span>, peptides))</code></pre></div>
<pre><code>## [1] &quot;aAAGEAk&quot; &quot;VTEEAk&quot;  &quot;aSGDPGk&quot; &quot;sAAXXAk&quot; &quot;aANXXGk&quot; &quot;aAXXEAR&quot;</code></pre>
<p>But careful that <code>sub</code> only replaced the first occurrence in a string!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(peptides)</code></pre></div>
<pre><code>## [1] &quot;aAAGEAk&quot; &quot;VTEEAk&quot;  &quot;aSGDPGk&quot; &quot;sAAAEAk&quot; &quot;aANAEGk&quot; &quot;aAAEEAR&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">sub</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;X&quot;</span>, peptides))</code></pre></div>
<pre><code>## [1] &quot;aXAGEAk&quot; &quot;VTEEXk&quot;  &quot;aSGDPGk&quot; &quot;sXAAEAk&quot; &quot;aXNAEGk&quot; &quot;aXAEEAR&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">gsub</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;X&quot;</span>, peptides))</code></pre></div>
<pre><code>## [1] &quot;aXXGEXk&quot; &quot;VTEEXk&quot;  &quot;aSGDPGk&quot; &quot;sXXXEXk&quot; &quot;aXNXEGk&quot; &quot;aXXEEXR&quot;</code></pre>
</div>
<div id="analysing-data-from-multiple-files" class="section level2">
<h2><span class="header-section-number">9.6</span> Analysing data from multiple files</h2>
<p>This exercise recapitulates the most important material that we have seem in the course. We are going to analyse the student tests A and B results using functionality from the <code>dplyr</code> package (seen in chapter @(sec:dplyr)). The student test files are available in the <code>rWSBIM1207</code> package (the <code>interroA.csv</code> and <code>interroB.csv</code> functions return their respective paths). We want to compare how the male and female students in groups A and B have performed. To do this, we want to calculate the mean scores and visualise the score distributions in each groups.</p>
<div class="question">
<p class="question-begin">
► Question
</p>
<div class="question-body">
<p>Before writing any code to answer the questions above, take a couple of minutes to think about what packages are needed to answer the questions above and identify the individual steps needed to first prepare the data needed to find the answers and then to produce the answers.</p>
<p class="question-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<ol style="list-style-type: decimal">
<li>Start by loading the <code>rWSBIM1207</code> and <code>tidyverse</code> package, to get all the functionality we will need.</li>
</ol>
<div class="solution">
<p class="solution-begin">
► Solution<span id="sol-start-51" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-51&#39;, &#39;sol-start-51&#39;)"></span>
</p>
<div id="sol-body-51" class="solution-body" style="display: none;">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;rWSBIM1207&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Using the <code>interroA.csv()</code> and <code>interroB.csv()</code> functions from the <code>rWSBIM1207</code> package, create a vector containing the two csv file names.</li>
</ol>
<div class="solution">
<p class="solution-begin">
► Solution<span id="sol-start-52" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-52&#39;, &#39;sol-start-52&#39;)"></span>
</p>
<div id="sol-body-52" class="solution-body" style="display: none;">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fls &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">interroA.csv</span>(),
         <span class="kw">interroB.csv</span>())
fls</code></pre></div>
<pre><code>## [1] &quot;/home/lgatto/R/x86_64-pc-linux-gnu-library/3.5/rWSBIM1207/extdata/interroA.csv&quot;
## [2] &quot;/home/lgatto/R/x86_64-pc-linux-gnu-library/3.5/rWSBIM1207/extdata/interroB.csv&quot;</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<ol start="3" style="list-style-type: decimal">
<li>Iterate over the files and read each into an element of a list. Then, bind the two elements of the list into a single dataframe containing all results.</li>
</ol>
<div class="solution">
<p class="solution-begin">
► Solution<span id="sol-start-53" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-53&#39;, &#39;sol-start-53&#39;)"></span>
</p>
<div id="sol-body-53" class="solution-body" style="display: none;">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l &lt;-<span class="st"> </span><span class="kw">as.list</span>(fls)
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(fls))
    l[[i]] &lt;-<span class="st"> </span><span class="kw">read_csv</span>(fls[i])</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_character(),
##   height = col_double(),
##   gender = col_character(),
##   X = col_double(),
##   interro1 = col_double(),
##   interro2 = col_double(),
##   interro3 = col_double(),
##   interro4 = col_double()
## )
## Parsed with column specification:
## cols(
##   id = col_character(),
##   height = col_double(),
##   gender = col_character(),
##   X = col_double(),
##   interro1 = col_double(),
##   interro2 = col_double(),
##   interro3 = col_double(),
##   interro4 = col_double()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interros &lt;-<span class="st"> </span><span class="kw">rbind</span>(l[[<span class="dv">1</span>]], l[[<span class="dv">2</span>]])
interros</code></pre></div>
<pre><code>## # A tibble: 205 x 8
##    id     height gender      X interro1 interro2 interro3 interro4
##    &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 A74890    168 M       1.43        16       18        7       10
##  2 A85494    167 M       1.05        15       18       13       NA
##  3 A51820    166 M       0.435        4       10       NA        7
##  4 A98669    164 M       0.715       15       15       18       13
##  5 A75521    171 M       0.917       18       10       17       NA
##  6 A96704    178 F      -2.66        11       20       14       17
##  7 A23214    155 M       1.11        12        2        8       14
##  8 A31124    177 M      -0.485       19        4        8       20
##  9 A80471    187 F       0.231       19       16       16        8
## 10 A21783    195 F      -0.295       13       11        8       20
## # … with 195 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(interros)</code></pre></div>
<pre><code>## [1] 205   8</code></pre>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l &lt;-<span class="st"> </span><span class="kw">lapply</span>(fls, read_csv)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_character(),
##   height = col_double(),
##   gender = col_character(),
##   X = col_double(),
##   interro1 = col_double(),
##   interro2 = col_double(),
##   interro3 = col_double(),
##   interro4 = col_double()
## )
## Parsed with column specification:
## cols(
##   id = col_character(),
##   height = col_double(),
##   gender = col_character(),
##   X = col_double(),
##   interro1 = col_double(),
##   interro2 = col_double(),
##   interro3 = col_double(),
##   interro4 = col_double()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interros2 &lt;-<span class="st"> </span><span class="kw">rbind</span>(l[[<span class="dv">1</span>]], l[[<span class="dv">2</span>]])
<span class="kw">identical</span>(interros, interros2)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<ol start="4" style="list-style-type: decimal">
<li>What are the top scores for male and female students in each test (<code>interro1</code> to <code>interro4</code>).</li>
</ol>
<div class="solution">
<p class="solution-begin">
► Solution<span id="sol-start-54" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-54&#39;, &#39;sol-start-54&#39;)"></span>
</p>
<div id="sol-body-54" class="solution-body" style="display: none;">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interros <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(gender) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">m1 =</span> <span class="kw">mean</span>(interro1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
              <span class="dt">m2 =</span> <span class="kw">mean</span>(interro2, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
              <span class="dt">m3 =</span> <span class="kw">mean</span>(interro3, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
              <span class="dt">m4 =</span> <span class="kw">mean</span>(interro4, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   gender    m1    m2    m3    m4
##   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 F       10.2  11.2  13.8  13.9
## 2 M       10.2  10.8  12.8  13.7</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<ol start="5" style="list-style-type: decimal">
<li>What are the top scores for male and female students in each test (<code>interro1</code> to <code>interro4</code>) and in each group.</li>
</ol>
<div class="solution">
<p class="solution-begin">
► Solution<span id="sol-start-55" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-55&#39;, &#39;sol-start-55&#39;)"></span>
</p>
<div id="sol-body-55" class="solution-body" style="display: none;">
<p>To answer this question, we need to be able to tell the two groups apart. This information is however not available in the full dataset. We could analyse the two test individually to answer this particular question, but a preferred approach is the add this information, as it will be needed later anyway.</p>
<p>One way would be to check the number of students that tool the two tests, and add a new column based on these values. We still have the two dataframes in the <code>l</code> list, which allows us to calculate the respective number of rows and use this information to create a group variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(l, nrow)</code></pre></div>
<pre><code>## [1] 100 105</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interros<span class="op">$</span>group &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;A&quot;</span>, <span class="kw">nrow</span>(l[[<span class="dv">1</span>]])),
                    <span class="kw">rep</span>(<span class="st">&quot;B&quot;</span>, <span class="kw">nrow</span>(l[[<span class="dv">2</span>]])))
interros</code></pre></div>
<pre><code>## # A tibble: 205 x 9
##    id     height gender      X interro1 interro2 interro3 interro4 group
##    &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;
##  1 A74890    168 M       1.43        16       18        7       10 A    
##  2 A85494    167 M       1.05        15       18       13       NA A    
##  3 A51820    166 M       0.435        4       10       NA        7 A    
##  4 A98669    164 M       0.715       15       15       18       13 A    
##  5 A75521    171 M       0.917       18       10       17       NA A    
##  6 A96704    178 F      -2.66        11       20       14       17 A    
##  7 A23214    155 M       1.11        12        2        8       14 A    
##  8 A31124    177 M      -0.485       19        4        8       20 A    
##  9 A80471    187 F       0.231       19       16       16        8 A    
## 10 A21783    195 F      -0.295       13       11        8       20 A    
## # … with 195 more rows</code></pre>
<p>The assumption here is that the order of the observations in the large dataframe hasn’t changed!</p>
<p>An alternative is to add the group information before combining the dataframes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l[[<span class="dv">1</span>]]<span class="op">$</span>group &lt;-<span class="st"> &quot;A&quot;</span>
l[[<span class="dv">2</span>]]<span class="op">$</span>group &lt;-<span class="st"> &quot;B&quot;</span>
interros2 &lt;-<span class="st"> </span><span class="kw">rbind</span>(l[[<span class="dv">1</span>]], l[[<span class="dv">2</span>]])
<span class="kw">identical</span>(interros, interros2)</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Now we can group by <code>gender</code> and <code>group</code> to perform our summary calculations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interros <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(gender, group) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">m1 =</span> <span class="kw">mean</span>(interro1, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
              <span class="dt">m2 =</span> <span class="kw">mean</span>(interro2, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
              <span class="dt">m3 =</span> <span class="kw">mean</span>(interro3, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
              <span class="dt">m4 =</span> <span class="kw">mean</span>(interro4, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 4 x 6
## # Groups:   gender [2]
##   gender group    m1    m2    m3    m4
##   &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 F      A      9.6   10.5  13.2  13.8
## 2 F      B     10.9   12.0  14.4  14.0
## 3 M      A     10.4   10.6  12.4  14.9
## 4 M      B      9.98  10.9  13.1  12.6</code></pre>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>
<ol start="6" style="list-style-type: decimal">
<li>Instead of comparing the means for the four tests in each group and gender, visualise their distributions using boxplots. In addition to the boxplots, overlay the actual score values (using the <em>jitter</em> geom) and colour the points based on the students height. w</li>
</ol>
<div class="solution">
<p class="solution-begin">
► Solution<span id="sol-start-56" class="fa fa-plus-square solution-icon clickable" onclick="toggle_visibility(&#39;sol-body-56&#39;, &#39;sol-start-56&#39;)"></span>
</p>
<div id="sol-body-56" class="solution-body" style="display: none;">
<p>The produce this visualisation, we first need to convert the data we have in a long format using <code>gather</code>. Below, we create two new variables: <code>test</code>, that contains <code>interro1</code>, …, <code>interro4</code>, and <code>score</code>, that contains the students marks the actual test.</p>
<p>We obtain a new tibble that contains 4 times more rows that initially, as the tests, that were in 4 different columns, have now been gathered as a single new variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interros2 &lt;-<span class="st"> </span><span class="kw">gather</span>(interros, <span class="dt">key =</span> test,
                    <span class="dt">value =</span> score,
                    <span class="kw">starts_with</span>(<span class="st">&quot;interro&quot;</span>))
interros2</code></pre></div>
<pre><code>## # A tibble: 820 x 7
##    id     height gender      X group test     score
##    &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;
##  1 A74890    168 M       1.43  A     interro1    16
##  2 A85494    167 M       1.05  A     interro1    15
##  3 A51820    166 M       0.435 A     interro1     4
##  4 A98669    164 M       0.715 A     interro1    15
##  5 A75521    171 M       0.917 A     interro1    18
##  6 A96704    178 F      -2.66  A     interro1    11
##  7 A23214    155 M       1.11  A     interro1    12
##  8 A31124    177 M      -0.485 A     interro1    19
##  9 A80471    187 F       0.231 A     interro1    19
## 10 A21783    195 F      -0.295 A     interro1    13
## # … with 810 more rows</code></pre>
<p>We can now map the new <code>test</code> and <code>score</code> variables to the <em>x</em> and <em>y</em> axes and construct the visualisation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(interros2, <span class="kw">aes</span>(<span class="dt">y =</span> score, <span class="dt">x =</span> test)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_jitter</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> height)) <span class="op">+</span><span class="st">  </span>
<span class="st">    </span><span class="kw">facet_grid</span>(gender <span class="op">~</span><span class="st"> </span>group)</code></pre></div>
<pre><code>## Warning: Removed 36 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning: Removed 36 rows containing missing values (geom_point).</code></pre>
<p><img src="WSBIM1207_files/figure-html/unnamed-chunk-225-1.png" width="672"  /></p>
<p class="solution-end">
<span class="fa fa-square-o solution-icon"></span>
</p>
</div>
</div>

</div>
</div>
<p style="text-align: center;">
<a href="sec-bioinfo.html"><button class="btn btn-default">Previous</button></a>
<a href="sec-ccl.html"><button class="btn btn-default">Next</button></a>
</p>
<p class="build-date">Page built: 
2019-03-12
</p>
</div>
</div>



</body>
</html>
